<!DOCTYPE html>  <html lang="pt-br">  
<head>  
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1" />  
  <title>Visualiza√ß√£o da Aposta</title>
  <style>
    body {
      font-family: sans-serif;
      background: #47ff15;
      text-align: center;
      padding: 20px;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 15px;
      max-width: 700px;
      margin: 0 auto;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    .duelo {
      margin-top: 10px;
      padding: 10px;
      border-radius: 8px;
      background: #f9f9f9;
      border: 1px solid #ddd;
      text-align: left;
    }
    h2 { font-size:18px;color: #25d366; }
    .ganhou { color: green; font-weight: bold; }
    .perdeu { color: red; font-weight: bold; }
    .carregando { color: orange; }
  </style>
</head>
<body>
<div id="visualizacao"><h2>Carregando...</h2></div>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
  import { getDatabase, ref, child, get } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA5a-2HzvcljnAfXE7P3ThDnq6m6E568ZA",
    authDomain: "jogo-60a9e.firebaseapp.com",
    projectId: "jogo-60a9e",
    storageBucket: "jogo-60a9e.appspot.com",
    messagingSenderId: "352852303591",
    appId: "1:352852303591:web:8083c950047c9026bd8c42",
    databaseURL: "https://jogo-60a9e-default-rtdb.firebaseio.com/"
  };

  const token = "SEU_TOKEN_API_FUTEBOL"; // Coloque seu token da API Futebol
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const container = document.getElementById("visualizacao");
  const urlParams = new URLSearchParams(window.location.search);
  const id = urlParams.get("id");

  async function buscarPlacar(idPartida) {
    try {
      const res = await fetch(`https://api.api-futebol.com.br/v1/partidas/${idPartida}`, {
        headers: { Authorization: `Bearer ${token}` }
      });
      if (!res.ok) throw new Error("Erro ao buscar API Futebol");
      const data = await res.json();

      return {
        status: data.status,
        campeonato: data.campeonato?.nome || "Desconhecido",
        placarA: data.placar_oficial_mandante,
        placarB: data.placar_oficial_visitante,
        minuto: data.tempo_real?.minuto,
        acrescimos: data.tempo_real?.acrescimo,
        timeA: data.time_mandante?.nome_popular,
        timeB: data.time_visitante?.nome_popular
      };
    } catch (err) {
      console.warn("Erro buscar placar:", err);
      return null;
    }
  }

  function verificarResultado(placarA, placarB, escolha) {
    if (escolha === "Casa" && placarA > placarB) return "Ganhou";
    if (escolha === "Fora" && placarB > placarA) return "Ganhou";
    if (escolha === "Empate" && placarA === placarB) return "Ganhou";
    return "Perdeu";
  }

  async function carregarAposta() {
    if (!id) {
      container.innerHTML = "<h2>‚ùå ID ausente na URL</h2>";
      return;
    }

    const snap = await get(child(ref(db), `apostas/${id}`));
    if (!snap.exists()) {
      container.innerHTML = "<h2>‚ùå Aposta n√£o encontrada</h2>";
      return;
    }

    const dados = snap.val();
    const nome = dados.nome || "Apostador";
    const data = dados.dataHora || "Data desconhecida";
    const selecoes = dados.selecoes || [];

    let html = `<h2>üìÑ Aposta de ${nome}</h2>`;
    html += `<p><strong>üïí Data:</strong> ${new Date(data).toLocaleString()}</p><hr/>`;
    html += `<div id="jogos"></div>`;
    container.innerHTML = html;

    atualizarJogos(selecoes);
    setInterval(() => atualizarJogos(selecoes), 30000); // Atualiza a cada 30s
  }

  async function atualizarJogos(selecoes) {
    const jogosDiv = document.getElementById("jogos");
    let html = "";

    for (const sel of selecoes) {
      let status = "<span style='color:orange;'>Carregando...</span>";
      let placar = "- x -", minuto = "", campeonato = "Desconhecido";

      if (sel.idPartida) {
        const resultado = await buscarPlacar(sel.idPartida);
        if (resultado) {
          const final = verificarResultado(resultado.placarA, resultado.placarB, sel.escolha);
          status = `<span style="color:${final === "Ganhou" ? "green" : "red"};">${final}</span>`;
          placar = `${resultado.placarA} x ${resultado.placarB}`;
          campeonato = resultado.campeonato;
          if (resultado.status === "em_andamento") {
            minuto = `<small>‚è± ${resultado.minuto}' +${resultado.acrescimos || 0}</small>`;
          } else if (resultado.status === "finalizado") {
            minuto = "<small>üèÅ Finalizado</small>";
          } else {
            minuto = `<small>‚åõ ${resultado.status}</small>`;
          }
        } else {
          status = "<span style='color:#999;'>Sem dados</span>";
        }
      } else {
        status = "<span style='color:#999;'>Sem ID da partida</span>";
      }

      html += `
        <div style="margin-bottom:15px;">
          <h3>üèÜ ${campeonato}</h3>
          <p><strong>${sel.timeA} x ${sel.timeB}</strong></p>
          <p><strong>Escolha:</strong> ${sel.escolha} | <strong>Cota√ß√£o:</strong> ${sel.valor}</p>
          <p><strong>Placar:</strong> ${placar} ${minuto}</p>
          <p><strong>Status:</strong> ${status}</p>
          <p><strong>Data/Hora:</strong> ${new Date(sel.dataHora).toLocaleString()}</p>
          <hr/>
        </div>
      `;
    }

    jogosDiv.innerHTML = html;
  }

  carregarAposta();
</script>
</body></html>
