<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Limpar Competições Antes de Casa / Emp / Fora</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f9f9f9;
    }
    textarea {
      width: 100%;
      height: 300px;
      padding: 10px;
      margin-top: 10px;
      font-family: monospace;
      font-size: 14px;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 16px;
    }
  </style>
</head>
<body>

  <h2>Remover títulos de competições antes de "Casa / Emp / Fora"</h2>

  <textarea id="entrada" placeholder="Cole aqui os dados..."></textarea>
  <br>
  <button onclick="limparCompeticoes()">Limpar Competições</button>
  <br>
  <h3>Resultado:</h3>
  <textarea id="saida" readonly></textarea>

  <script>
    function limparCompeticoes() {
      const texto = document.getElementById('entrada').value;
      const linhas = texto.split('\n');

      const resultado = [];
      let i = 0;

      while (i < linhas.length) {
        const linha = linhas[i].trim().toLowerCase();

        // Detecta o bloco "Casa / Emp / Fora"
        if (linha === 'casa' && i + 2 < linhas.length) {
          const emp = linhas[i + 1].trim().toLowerCase();
          const fora = linhas[i + 2].trim().toLowerCase();

          if ((emp === 'emp' || emp === 'emp.') && fora === 'fora') {
            // Verifica se linha anterior é nome de competição (1 ou 2 acima)
            const anterior1 = linhas[i - 1]?.trim();
            const anterior2 = linhas[i - 2]?.trim();

            // Remove anterior2 e anterior1 se forem títulos (não são odds, datas ou times)
            if (anterior2 && !anterior2.toLowerCase().includes('**') && isProvavelCompeticao(anterior2)) {
              resultado.pop(); // remove anterior1
              resultado.pop(); // remove anterior2
            } else if (anterior1 && !anterior1.toLowerCase().includes('**') && isProvavelCompeticao(anterior1)) {
              resultado.pop(); // remove anterior1
            }

            // Adiciona Casa / Emp / Fora
            resultado.push(linhas[i]);
            resultado.push(linhas[i + 1]);
            resultado.push(linhas[i + 2]);

            i += 3;
            continue;
          }
        }

        resultado.push(linhas[i]);
        i++;
      }

      document.getElementById('saida').value = resultado.join('\n');
    }

    // Heurística para detectar nomes de competições (simples)
    function isProvavelCompeticao(linha) {
      const padraoData = /^\d{1,2}\/[a-z]{3}/i;
      const padraoMaisNumero = /^\+\d+/;
      const padraoOdds = /^(\d+,){2}\d+/;
      const padraoTime = /^[a-zA-Z].*\s[a-zA-Z]{2,3}$/;

      return !(
        padraoData.test(linha) ||
        padraoMaisNumero.test(linha) ||
        padraoOdds.test(linha) ||
        padraoTime.test(linha)
      );
    }
  </script>

</body>
</html>
